---
title: "Gastos dos Deputados"
author: "Gustavo Monteiro"
date: "27 de agosto de 2018"
output: html_document
---

```{r}
library(tidyverse)
data = read_csv("./data.csv")
limit = read.csv("./limit.csv")

colnames(data)[3] <- "UF"
data = data %>%
  full_join(limit, by=c("UF", "UF"))
```

```{r}
# Quais são os deputados que gastaram mais dinheiro da CEAP? Quais são os mais econômicos?
summarized_data = data %>% 
    filter(valorDocumento > 0) %>% 
    group_by(nomeParlamentar) %>% 
    summarise(gastos = sum(valorDocumento))

summarized_data %>% 
  top_n(5, gastos) %>% 
  ggplot(aes(x = reorder(nomeParlamentar, gastos), y = gastos, fill = nomeParlamentar)) +
  geom_col(width = 0.7) +
    coord_flip()

summarized_data %>% 
  tail(5, gastos) %>% 
  ggplot(aes(x = reorder(nomeParlamentar, -gastos), y = gastos, fill = nomeParlamentar)) +
  geom_col(width = 0.7) +
  coord_flip()
```

```{r}
# Quais os estados cujos deputados gastam mais no exterior? Quais os estados cujos deputados gastam menos no exterior?
e_exprenses = data %>% 
  filter(tipoDocumento == 2) %>% 
  group_by(nomeParlamentar) %>% 
  summarise(gastos = sum(valorDocumento))

e_exprenses %>% 
  top_n(5, gastos) %>% 
  ggplot(aes(x = reorder(nomeParlamentar, gastos), y = gastos, fill = nomeParlamentar)) +
  geom_col(width = 0.7) +
    coord_flip()

e_exprenses %>% 
  tail(5, gastos) %>% 
  ggplot(aes(x = reorder(nomeParlamentar, -gastos), y = gastos, fill = nomeParlamentar)) +
  geom_col(width = 0.7) +
  coord_flip()
```

```{r}
# Quais os partidos cujos parlamentares mais usam CEAP no estado da Paraíba? Quais são os que menos usam? Mesmas perguntas considerando valores em R$.
part = data %>%
  filter(UF == "PB") %>% 
  group_by(sgPartido) %>% 
  summarise(gastos = sum(valorDocumento))

part %>% 
  top_n(5, gastos) %>% 
  ggplot(aes(x = reorder(sgPartido, gastos), y = gastos, fill = sgPartido)) +
  geom_col(width = 0.7) +
    coord_flip()

part %>% 
  tail(5, gastos) %>% 
  ggplot(aes(x = reorder(sgPartido, -gastos), y = gastos, fill = sgPartido)) +
  geom_col(width = 0.7) +
  coord_flip()
```

```{r}
# Quais os deputados que mais ultrapassam o limite de CEAP do seu estado?
rm_limit = data %>% 
  filter(!is.na(dataEmissao)) %>% 
  group_by(nomeParlamentar, format(dataEmissao, "%m"), format(dataEmissao, "%y")) %>% 
  summarise(gastos = sum(valorLíquido), limite = mean(limite_mensal)) %>% 
  filter(gastos > limite) %>%
  group_by(nomeParlamentar) %>%
  summarise(gastos = max(gastos)) %>% 
  top_n(10, gastos)
```

```{r}
# Quais estados cujos parlamentares gastam mais com passagens aéreas?
flyers = data %>%
  filter(tipoDespesa == "Emissão Bilhete Aéreo") %>% 
  group_by(UF) %>% 
  summarise(gastos = sum(valorDocumento))
```

```{r}
# Escolha três partidos e responda: Quais são os tipos de despesa mais utilizados no uso da CEAP pelos deputados desses partidos? Mesma pergunta considerando valores em R$.

dem = data %>%
  filter(sgPartido == "DEM") %>% 
  group_by(tipoDespesa) %>% 
  summarise(gastos = sum(valorDocumento))

psl = data %>%
  filter(sgPartido == "PSL") %>% 
  group_by(tipoDespesa) %>% 
  summarise(gastos = sum(valorDocumento))


avante = data %>%
  filter(sgPartido == "AVANTE") %>% 
  group_by(tipoDespesa) %>% 
  summarise(gastos = sum(valorDocumento))
```


